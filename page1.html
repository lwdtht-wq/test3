<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Future Religious Trends ¬∑ Cyber Faith</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="style.css">
<script src="https://d3js.org/d3.v7.min.js"></script>
<script defer src="main.js"></script>

<style>
/* ---------------- Tooltip (Cyberpunk style) ---------------- */
.chart-tooltip {
  position: absolute;
  padding: 14px 18px;
  background: rgba(8, 18, 30, 0.85);
  border: 1px solid #4af1ff;
  border-radius: 10px;
  color: #dff6ff;
  pointer-events: none;
  font-size: 14px;
  display: none;
  backdrop-filter: blur(6px);
  box-shadow: 0 0 12px #4af1ff99;
  transform: translateY(-10px);
}

/* Legend */
.legend-btn {
  padding: 6px 12px;
  background: rgba(10,20,30,0.6);
  border: 1px solid #4af1ff88;
  color: #9bddff;
  border-radius: 6px;
  cursor: pointer;
  margin-right: 10px;
  transition: 0.2s;
}
.legend-btn:hover {
  box-shadow: 0 0 10px #4af1ff;
}
.legend-btn.active {
  background: #4af1ff22;
  box-shadow: 0 0 12px #4af1ff;
}
</style>

</head>
<body>

<!-- ======================= PAGE OPENING ======================= -->
<div class="page-opening">
    <img src="assets/open1.jpg">
    <div class="page-title-overlay glitch" data-text="FUTURE RELIGION TRENDS">
        FUTURE RELIGION TRENDS
    </div>
</div>

<!-- ======================= NAV ======================= -->
<nav id="sideNav" class="hidden">
    <a href="index.html" class="nav-icon" data-label="Home">üúÇ</a>
    <a href="page1.html" class="nav-icon" data-label="Trends">üúÅ</a>
    <a href="page2.html" class="nav-icon" data-label="New Faiths">‚üü</a>
    <a href="page3.html" class="nav-icon" data-label="World Map">üúÑ</a>
    <a href="page4.html" class="nav-icon" data-label="Liquid Metal">‚üÅ</a>
    <a href="page5.html" class="nav-icon" data-label="Story">‚õõ</a>
</nav>

<!-- ======================= CONTENT ======================= -->
<section class="page-panel">

<h2>Projected Growth of Religious Groups (2010‚Äì2150)</h2>

<p>
This chart combines partial real-world data with speculative future projections.
Hover to explore interpolated values in cyber space.
</p>

<!-- Legend -->
<div style="margin-bottom:20px;">
  <button class="legend-btn active" data-key="traditional">Traditional</button>
  <button class="legend-btn active" data-key="tech">Techno-Faith</button>
  <button class="legend-btn active" data-key="none">Unaffiliated</button>
</div>

<div id="chart" style="width:100%;height:460px;margin-top:20px;"></div>

</section>

<!-- ======================= D3 SCRIPT ======================= -->
<script>
/* ---------------- DATA ---------------- */
const data = [
  { year: 2010, traditional: 83, tech: 0, none: 17 },
  { year: 2020, traditional: 78, tech: 0, none: 22 },
  { year: 2030, traditional: 60, tech: 5, none: 35 },
  { year: 2040, traditional: 48, tech: 18, none: 34 },
  { year: 2050, traditional: 35, tech: 32, none: 33 },
  { year: 2075, traditional: 20, tech: 55, none: 25 },
  { year: 2100, traditional: 12, tech: 68, none: 20 },
  { year: 2150, traditional: 5,  tech: 82, none: 13 }
];

const w = 900, h = 420;
const margin = { top: 40, right: 80, bottom: 40, left: 70 };

const svg = d3.select("#chart")
  .append("svg")
  .attr("width", w)
  .attr("height", h);

const x = d3.scaleLinear()
  .domain([2010, 2150])
  .range([margin.left, w - margin.right]);

const y = d3.scaleLinear()
  .domain([0, 100])
  .range([h - margin.bottom, margin.top]);

svg.append("g")
  .attr("transform", `translate(0, ${h - margin.bottom})`)
  .call(d3.axisBottom(x).ticks(8).tickFormat(d3.format("d")))
  .attr("color", "#7bc4ff");

svg.append("g")
  .attr("transform", `translate(${margin.left}, 0)`)
  .call(d3.axisLeft(y))
  .attr("color", "#7bc4ff");

/* ---------------- COLORS ---------------- */
const colors = {
  traditional: "#ff3df2",
  tech: "#4af1ff",
  none: "#8cc7ff"
};

/* ---------------- LINE GENERATOR ---------------- */
function drawLine(key) {
  const line = d3.line()
    .x(d => x(d.year))
    .y(d => y(d[key]))
    .curve(d3.curveMonotoneX);

  const p = svg.append("path")
    .datum(data)
    .attr("fill", "none")
    .attr("stroke", colors[key])
    .attr("stroke-width", 3)
    .attr("d", line)
    .style("filter", "drop-shadow(0 0 8px " + colors[key] + ")");

  return p;
}

let paths = {
  traditional: drawLine("traditional"),
  tech: drawLine("tech"),
  none: drawLine("none")
};

/* ---------------- INTERPOLATION FUNCTION ---------------- */
function interpolateValue(year, key) {
  for (let i = 0; i < data.length - 1; i++) {
    let a = data[i];
    let b = data[i + 1];
    if (year >= a.year && year <= b.year) {
      const t = (year - a.year) / (b.year - a.year);
      return a[key] + t * (b[key] - a[key]);
    }
  }
  return null;
}

/* ---------------- FOLLOW POINTS ---------------- */
let followDots = {
  traditional: svg.append("circle")
    .attr("r", 7)
    .attr("fill", colors.traditional)
    .style("filter", "drop-shadow(0 0 8px " + colors.traditional + ")")
    .style("display", "none"),

  tech: svg.append("circle")
    .attr("r", 7)
    .attr("fill", colors.tech)
    .style("filter", "drop-shadow(0 0 8px " + colors.tech + ")")
    .style("display", "none"),

  none: svg.append("circle")
    .attr("r", 7)
    .attr("fill", colors.none)
    .style("filter", "drop-shadow(0 0 8px " + colors.none + ")")
    .style("display", "none")
};

/* ---------------- HOVER LINE + TOOLTIP ---------------- */
const tooltip = document.createElement("div");
tooltip.className = "chart-tooltip";
document.body.appendChild(tooltip);

const hoverLine = svg.append("line")
  .attr("stroke", "#4af1ff99")
  .attr("stroke-width", 2)
  .style("display", "none")
  .attr("y1", margin.top)
  .attr("y2", h - margin.bottom);

/* ---------------- MOUSE MOVE ---------------- */
svg.on("mousemove", function(event) {
  const [mx] = d3.pointer(event);
  let year = x.invert(mx);
  year = Math.min(2150, Math.max(2010, year));

  hoverLine
    .attr("x1", x(year))
    .attr("x2", x(year))
    .style("display", "block");

  const values = {
    traditional: interpolateValue(year, "traditional"),
    tech: interpolateValue(year, "tech"),
    none: interpolateValue(year, "none")
  };

  Object.keys(values).forEach(key => {
    followDots[key]
      .attr("cx", x(year))
      .attr("cy", y(values[key]))
      .style("display", "block");
  });

  tooltip.style.display = "block";
  tooltip.style.left = event.pageX + 15 + "px";
  tooltip.style.top = event.pageY - 40 + "px";
  tooltip.innerHTML = `
    <strong>${Math.round(year)}</strong><br>
    Traditional: ${values.traditional.toFixed(1)}%<br>
    Techno-Faith: ${values.tech.toFixed(1)}%<br>
    None: ${values.none.toFixed(1)}%
  `;
});

svg.on("mouseleave", () => {
  hoverLine.style("display", "none");
  tooltip.style.display = "none";
  Object.values(followDots).forEach(dot => dot.style("display", "none"));
});

/* ---------------- LEGEND TOGGLE ---------------- */
document.querySelectorAll(".legend-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const key = btn.dataset.key;
    const active = btn.classList.toggle("active");

    paths[key].style("display", active ? "block" : "none");
    followDots[key].style("display", active ? "block" : "none");
  });
});
</script>

</body>
</html>
