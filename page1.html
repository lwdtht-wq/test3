<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Future Religious Trends Â· Cyber Faith</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="style.css">
<script src="https://d3js.org/d3.v7.min.js"></script>
<script defer src="main.js"></script>

</head>
<body>

<!-- ======================= PAGE OPENING ======================= -->
<div class="page-opening">
    <img src="assets/open1.jpg">
    <div class="page-title-overlay glitch" data-text="FUTURE RELIGION TRENDS">
        FUTURE RELIGION TRENDS
    </div>
</div>

<!-- ======================= FLOATING NAV ======================= -->
<nav id="sideNav" class="hidden">
    <a href="index.html" class="nav-icon" data-label="Home">ğŸœ‚</a>
    <a href="page1.html" class="nav-icon" data-label="Trends">ğŸœ</a>
    <a href="page2.html" class="nav-icon" data-label="New Faiths">âŸŸ</a>
    <a href="page3.html" class="nav-icon" data-label="World Map">ğŸœ„</a>
    <a href="page4.html" class="nav-icon" data-label="Liquid Metal">âŸ</a>
    <a href="page5.html" class="nav-icon" data-label="Story">â››</a>
</nav>

<!-- ======================= PAGE CONTENT ======================= -->
<section class="page-panel">

<h2>Projected Growth of Religious Groups (2010â€“2150)</h2>

<p>
This chart combines partial real-world data with speculative future projections.
It illustrates how traditional religions decline as techno-faith systems rise,
reshaping the spiritual landscape of the cybernetic world.
</p>

<div id="chart" style="width:100%;height:460px;margin-top:40px;"></div>

</section>

<!-- ======================= D3 SCRIPT ======================= -->
<!-- ======================= D3 SCRIPT ======================= -->
<script>
/* Dataset */
const data = [
  { year: 2010, traditional: 83, tech: 0, none: 17 },
  { year: 2020, traditional: 78, tech: 0, none: 22 },
  { year: 2030, traditional: 60, tech: 5, none: 35 },
  { year: 2040, traditional: 48, tech: 18, none: 34 },
  { year: 2050, traditional: 35, tech: 32, none: 33 },
  { year: 2075, traditional: 20, tech: 55, none: 25 },
  { year: 2100, traditional: 12, tech: 68, none: 20 },
  { year: 2150, traditional: 5,  tech: 82, none: 13 }
];

const width = 900;
const height = 420;
const margin = { top: 40, right: 80, bottom: 40, left: 70 };

const svg = d3.select("#chart")
  .append("svg")
  .attr("width", width)
  .attr("height", height);

/* Scales */
const x = d3.scaleLinear()
  .domain(d3.extent(data, d => d.year))
  .range([margin.left, width - margin.right]);

const y = d3.scaleLinear()
  .domain([0, 100])
  .range([height - margin.bottom, margin.top]);

/* Axes */
svg.append("g")
  .attr("transform", `translate(0, ${height - margin.bottom})`)
  .call(d3.axisBottom(x).ticks(7).tickFormat(d3.format("d")))
  .attr("color", "#7bc4ff");

svg.append("g")
  .attr("transform", `translate(${margin.left}, 0)`)
  .call(d3.axisLeft(y))
  .attr("color", "#7bc4ff`);

/* --------------------------
   1. ADD VERTICAL HOVER LINE
--------------------------- */
const vLine = svg.append("line")
  .attr("stroke", "#4af1ff88")
  .attr("stroke-width", 1.5)
  .attr("y1", margin.top)
  .attr("y2", height - margin.bottom)
  .style("display", "none");

/* --------------------------
   2. ADD YEAR HOVER LABEL
--------------------------- */
const yearLabel = svg.append("text")
  .attr("fill", "#a9ddff")
  .attr("font-size", "14px")
  .style("display", "none");

/* --------------------------
   3. DRAW LINES
--------------------------- */
const colors = {
  traditional: "#ff3df2",
  tech: "#4af1ff",
  none: "#8cc7ff"
};

/* Draw each line with grouping */
function drawLine(key, color) {
  const lineGroup = svg.append("g").attr("class", `line-group ${key}`);

  lineGroup.append("path")
    .datum(data)
    .attr("fill", "none")
    .attr("stroke", color)
    .attr("stroke-width", 2.6)
    .attr("d", d3.line()
      .x(d => x(d.year))
      .y(d => y(d[key]))
    );

  // Label at end
  lineGroup.append("text")
    .attr("x", x(data[data.length - 1].year) + 10)
    .attr("y", y(data[data.length - 1][key]))
    .attr("fill", color)
    .attr("font-size", "14px")
    .text(key === "traditional" ? "Traditional" :
          key === "tech" ? "Techno-Faith" : "None");
}

drawLine("traditional", colors.traditional);
drawLine("tech", colors.tech);
drawLine("none", colors.none);

/* --------------------------
   4. PULSE DOTS + TOOLTIP
--------------------------- */
["traditional","tech","none"].forEach(key => {
  const dots = svg.append("g").selectAll(".dot")
    .data(data)
    .enter()
    .append("circle")
      .attr("class", `dot dot-${key}`)
      .attr("cx", d => x(d.year))
      .attr("cy", d => y(d[key]))
      .attr("r", 6)
      .attr("fill", colors[key])
      .attr("stroke", "#fff")
      .style("cursor", "pointer");

  // Hover pulse animation
  dots.on("mouseenter", function () {
    d3.select(this)
      .transition()
      .duration(180)
      .attr("r", 10)
      .attr("stroke-width", 2);
  });

  dots.on("mouseleave", function () {
    d3.select(this)
      .transition()
      .duration(180)
      .attr("r", 6)
      .attr("stroke-width", 1);
  });

  // Connect to your tooltip system
  enableChartTooltip(svg, data, x, y, key);
});

/* --------------------------
   5. HOVER MOVEMENT INTERACTION
--------------------------- */

svg.on("mousemove", function (event) {
  const mouseX = d3.pointer(event)[0];

  if (mouseX < margin.left || mouseX > width - margin.right) return;

  vLine
    .attr("x1", mouseX)
    .attr("x2", mouseX)
    .style("display", "block");

  // Find closest year
  const closest = data.reduce((a, b) =>
    Math.abs(x(b.year) - mouseX) < Math.abs(x(a.year) - mouseX) ? b : a
  );

  yearLabel
    .attr("x", mouseX + 10)
    .attr("y", margin.top + 10)
    .text(closest.year)
    .style("display", "block");

  // Dim all lines
  svg.selectAll(".line-group").attr("opacity", 0.25);

  // Highlight nearest yearâ€™s point
  svg.selectAll(".dot")
    .attr("opacity", 0.35);

  // Highlight corresponding points
  svg.selectAll(`.dot-traditional, .dot-tech, .dot-none`)
    .filter(d => d.year === closest.year)
    .attr("opacity", 1)
    .attr("r", 9);
});

/* Hide hover UI */
svg.on("mouseleave", function () {
  vLine.style("display", "none");
  yearLabel.style("display", "none");

  svg.selectAll(".line-group").attr("opacity", 1);
  svg.selectAll(".dot")
    .attr("opacity", 1)
    .attr("r", 6);
});

</script>
